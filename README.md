# 图片转GIF工具

这是一个C# WinForms桌面应用，用于将PNG图片按n*m网格裁剪并制作成GIF动画。

## 功能特性

- 🖼️ **多种上传方式**：支持点击上传和拖拽上传图片到预览窗口
- 📐 **自定义网格裁剪**：可设置裁剪的行数和列数（n*m网格）
- ⚡ **自定义播放速度**：支持1-120fps的帧率调节，默认30fps
- 📏 **实时网格显示**：可开关的网格分隔线，便于查看裁剪边界
- 🎬 **GIF生成预览**：生成后可立即预览GIF效果
- 📊 **进度显示**：实时显示生成进度和状态
- 🚀 **一键分享**：支持拖拽生成的GIF到QQ等聊天窗口
- 🎨 **友好界面**：双面板布局，原图和GIF预览并排显示

## 运行要求

- .NET 8.0 或更高版本
- Windows 操作系统

## 安装和运行

1. 克隆或下载项目文件
2. 在项目根目录打开命令行
3. 运行以下命令还原依赖包：
   ```bash
   dotnet restore
   ```
4. 运行项目：
   ```bash
   dotnet run
   ```

## 使用说明

### 方式一：点击上传
1. **上传图片**：点击"上传图片"按钮，选择要处理的PNG/JPG/JPEG/BMP文件
2. **设置参数**：
   - 在"行数"输入框中设置要裁剪的行数（n）
   - 在"列数"输入框中设置要裁剪的列数（m）
   - 在"帧率(fps)"输入框中设置GIF播放速度（1-120fps，默认30fps）
   - 可以勾选/取消"显示网格线"来查看或隐藏裁剪边界

### 方式二：拖拽上传（推荐）
- 直接将图片文件拖拽到左侧"原图预览"区域

### 生成和分享
3. **生成GIF**：点击"生成GIF"按钮，程序会：
   - 显示生成进度条
   - 按从左到右、从上到下的顺序裁剪图片
   - 在右侧预览区显示生成的GIF
   - 自动保存到桌面（文件名包含时间戳）

4. **分享GIF**：
   - 在右侧GIF预览区域按住鼠标左键拖拽到QQ聊天窗口即可发送（表情包形式，可直接预览）
   - 支持多种拖拽格式：表情包 + 文件格式，确保兼容性
   - 或者手动从桌面复制生成的GIF文件

### 播放速度控制
- **1-10fps**：慢动作效果
- **15-30fps**：标准动画速度
- **30-60fps**：流畅动画效果（默认60fps）
- **60-120fps**：高速动画效果

## 界面布局
- **左侧面板**：原图预览（支持拖拽上传）
- **右侧面板**：GIF预览（支持拖拽分享）
- **顶部控制区**：参数设置和生成按钮
- **进度显示区**：实时显示生成进度

## 技术实现

- **UI框架**：Windows Forms
- **图片处理**：System.Drawing.Common
- **GIF生成**：ImageMagick.NET (Magick.NET)
- **开发语言**：C# (.NET 8.0)

## 项目结构

```
ImageToGifConverter/
├── ImageToGifConverter.csproj  # 项目文件
├── Program.cs                  # 应用程序入口点
├── MainForm.cs                 # 主窗体实现
└── README.md                   # 说明文档
```

## 注意事项

- **支持的格式**：PNG、JPG、JPEG、BMP格式的输入图片
- **生成参数**：GIF中每帧的延迟时间设置为200毫秒，获得较好的播放效果
- **保存位置**：生成的GIF自动保存到桌面，文件名包含时间戳避免覆盖
- **性能优化**：修复了原版本中线程安全问题，生成过程更加稳定
- **最佳实践**：建议输入图片的尺寸能够被设置的行列数整除，以获得最佳效果

## 新版本改进

### 🔧 修复的问题
- ✅ 修复了GIF生成时SaveFileDialog在后台线程调用的崩溃问题
- ✅ 解决了GIF生成无响应的线程安全问题
- ✅ 修复了MagickImage对象被释放的错误
- ✅ 修复了GIF预览窗口无法拖拽到QQ的bug
- ✅ 优化了GIF播放速度，默认提升至60fps
- ✅ 实现表情包拖拽功能，支持直接在QQ中预览
- ✅ 优化了内存使用，避免图片资源泄漏

### 🎉 新增功能
- ✅ 支持拖拽图片到预览窗口上传
- ✅ 添加GIF实时预览功能
- ✅ 显示详细生成进度和状态
- ✅ 支持拖拽生成的GIF到QQ等聊天窗口
- ✅ 扩展支持多种图片格式（PNG/JPG/JPEG/BMP）
- ✅ 改进的UI布局，更直观的双面板设计
- ✅ 自动保存到桌面，文件名包含时间戳
- ✅ 自定义GIF播放速度（1-120fps）