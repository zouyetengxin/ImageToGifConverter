# 图片转GIF工具 v2.0

这是一个C# WinForms桌面应用，支持图片序列帧处理、图集生成、GIF制作，具有三面板独立工作模式。

## 🆕 v2.0 重大更新

### 🏗️ 全新三面板架构
- **窗口1 - 序列帧预览**：支持多图片上传、拖拽重排序、序列帧管理
- **窗口2 - 图集预览**：显示图片图集、支持网格裁剪、QQ拖拽功能
- **窗口3 - GIF预览**：GIF播放预览、QQ拖拽分享、裁剪功能

### 🔄 工作流程升级
1. **灵活上传**：窗口1支持拖拽批量图片上传
2. **智能排序**：窗口1内可直接拖拽图片重新排序
3. **图集生成**：从序列帧自动生成图集到窗口2
4. **GIF制作**：支持从序列帧或图集生成GIF到窗口3
5. **QQ分享**：窗口2、3都支持直接拖拽到QQ聊天窗口

## 功能特性

### 📁 序列帧管理（窗口1）
- 🖼️ **批量上传**：支持拖拽多个图片文件
- 🔄 **拖拽排序**：鼠标左键拖拽重排序列帧顺序
- 🎯 **QQ分享**：左键单击或Ctrl+左键拖拽到QQ聊天窗口
- 📦 **生成选项**：转为图集、转为GIF、保存序列帧

### 🗺️ 图集处理（窗口2）
- 📐 **网格显示**：实时显示n*m网格分割线
- ✂️ **裁剪功能**：按网格将图集裁剪为序列帧
- 🎨 **QQ拖拽**：左键直接拖拽图集到QQ聊天窗口
- 🔄 **格式转换**：图集→序列帧、图集→GIF

### 🎬 GIF预览（窗口3）
- ▶️ **实时预览**：生成后立即预览GIF播放效果
- 📏 **裁剪工具**：自定义裁剪GIF尺寸
- 🚀 **QQ分享**：左键直接拖拽GIF到QQ聊天窗口
- ⚙️ **播放控制**：自定义GIF播放速度（1-120fps）

### 🛠️ 通用功能
- 📁 **输出路径**：每个面板独立设置输出目录
- 📊 **参数同步**：全局统一设置行数、列数、帧率参数
- 💾 **批量保存**：支持保存序列帧、图集、GIF到指定路径
- 🔄 **数据清理**：一键清理当前面板数据

## 运行要求

- .NET 8.0 或更高版本
- Windows 操作系统

## 安装和运行

1. 克隆或下载项目文件
2. 在项目根目录打开命令行
3. 运行以下命令还原依赖包：
   ```bash
   dotnet restore
   ```
4. 运行项目：
   ```bash
   dotnet run
   ```

## 详细使用说明

### 🖼️ 窗口1：序列帧预览

#### 上传图片
- **拖拽上传**：直接拖拽批量图片文件到窗口1
- **支持格式**：PNG、JPG、JPEG、BMP
- **批量处理**：自动识别并加载多张图片

#### 图片重排序
- **左键拖拽**：按住任意缩略图拖拽到目标位置
- **实时更新**：序列编号自动更新
- **数据同步**：底层数据同步交换

#### QQ分享功能
- **方式1**：左键单击缩略图，不移动鼠标直接松开
- **方式2**：Ctrl+左键点击缩略图
- **支持格式**：表情包格式，QQ中可直接预览

#### 生成选项
- **转为图集**：将序列帧合并为图集，自动显示在窗口2
- **转为GIF**：直接生成GIF，显示在窗口3
- **保存序列**：将序列帧保存为独立PNG文件

### 🗺️ 窗口2：图集预览

#### 图集管理
- **上传图集**：拖拽图片文件到窗口2
- **网格显示**：红色虚线网格显示裁剪边界
- **参数调节**：实时响应全局行列参数变化

#### 裁剪功能
- **网格裁剪**：按n*m网格将图集裁剪为多个小图
- **自动排序**：按从左到右、从上到下顺序裁剪
- **序列帧输出**：裁剪结果可发送到窗口1继续编辑

#### QQ拖拽
- **左键拖拽**：直接拖拽整个图集到QQ聊天窗口
- **表情包格式**：支持表情包形式预览
- **高质量输出**：保持原图分辨率

### 🎬 窗口3：GIF预览

#### GIF功能
- **播放预览**：实时预览GIF动画效果
- **帧率控制**：1-120fps可调节播放速度
- **裁剪工具**：自定义GIF显示尺寸

#### QQ分享
- **一键拖拽**：左键直接拖拽到QQ聊天窗口
- **兼容性**：支持QQ表情包格式
- **即时预览**：聊天窗口内直接预览动画

## 参数设置

### 全局参数
- **行数**：设置网格裁剪的行数（n）
- **列数**：设置网格裁剪的列数（m）
- **帧率(fps)**：GIF播放速度（1-120fps，默认30fps）
- **输出路径**：每个面板可独立设置保存路径

### 参数应用场景
- **图集生成**：使用行列数将序列帧排列成网格
- **图集裁剪**：按行列数将大图分割成小图
- **GIF制作**：帧率控制GIF播放速度

## 工作流程示例

### 方案1：序列帧→GIF
1. 窗口1：拖拽上传多张图片
2. 窗口1：拖拽调整图片顺序
3. 窗口1：点击"转为GIF"
4. 窗口3：预览生成的GIF
5. 窗口3：拖拽到QQ聊天窗口

### 方案2：序列帧→图集→GIF
1. 窗口1：上传并排序序列帧
2. 窗口1：点击"转为图集"
3. 窗口2：查看生成的图集
4. 窗口2：点击"转为GIF"
5. 窗口3：预览并分享GIF

### 方案3：图集→序列帧→编辑
1. 窗口2：上传现有图集
2. 窗口2：点击"转为序列"
3. 窗口1：接收序列帧
4. 窗口1：重新排序或编辑
5. 窗口1：重新生成图集或GIF

## 技术实现

- **UI框架**：Windows Forms
- **图片处理**：System.Drawing.Common
- **GIF生成**：ImageMagick.NET (Magick.NET)
- **开发语言**：C# (.NET 8.0)
- **架构设计**：模块化PanelBase基类架构

## 项目结构

```
ImageToGifConverter/
├── ImageToGifConverter.csproj  # 项目文件
├── Program.cs                  # 应用程序入口点
├── MainForm.cs                 # 主窗体实现
├── PanelBase.cs                # 面板基类
├── SequencePanel.cs            # 序列帧面板
├── AtlasPanel.cs               # 图集面板
├── GifPanel.cs                 # GIF面板
└── README.md                   # 说明文档
```

## 新版本改进 (v2.0)

### 🏗️ 架构重构
- ✅ 全新三面板独立架构设计
- ✅ 抽象PanelBase基类，代码复用性提升
- ✅ 模块化功能分离，维护性增强
- ✅ 面板间数据通信机制优化

### 🎯 功能增强
- ✅ 序列帧拖拽重排序功能
- ✅ QQ表情包拖拽支持（所有面板）
- ✅ 批量图片上传和文件夹拖拽
- ✅ 图集网格实时显示和裁剪
- ✅ GIF实时预览和播放控制
- ✅ 独立输出路径设置

### 🔧 体验优化
- ✅ 统一的左键操作方式
- ✅ Ctrl+左键快捷拖拽到QQ
- ✅ 实时参数同步和界面更新
- ✅ 更直观的视觉反馈
- ✅ 内存管理和资源清理优化

### 🐛 问题修复
- ✅ 拖拽到QQ聊天窗口兼容性问题
- ✅ 序列帧排序数据同步问题
- ✅ 图集网格显示准确性
- ✅ GIF播放速度单位修正
- ✅ 线程安全和资源释放

## 注意事项

- **性能建议**：大批量图片处理时建议逐步处理
- **内存管理**：程序会自动管理图片资源，但建议定期清理数据
- **QQ兼容性**：QQ拖拽功能需要QQ支持表情包格式
- **最佳实践**：建议输入图片尺寸适合设置的网格参数
- **文件格式**：支持PNG、JPG、JPEG、BMP输入，输出为PNG/GIF格式